import{r as a,A as E,a as u,b as d,j as o}from"./index-BcmIAXwz.js";function v(){const{logout:C}=a.useContext(E),[k,w]=a.useState([]),[r,$]=a.useState(null),[n,c]=a.useState([]),[l,p]=a.useState(0),[g,b]=a.useState(null),[f,m]=a.useState(!1),[y,i]=a.useState(null),[S,h]=a.useState(null),x=e=>{e.response&&e.response.status===401?(alert("Session expired or unauthorized. Please login again."),C()):console.error(e)};a.useEffect(()=>{const e=localStorage.getItem("authToken");u.get(`${d}/subject/fetch-with-query`,{withCredentials:!0,headers:{Authorization:`Bearer ${e}`}}).then(t=>{t.data.success&&w(t.data.subjects||t.data.data||[])}).catch(t=>{x(t)})},[]),a.useEffect(()=>{if(r){const e=localStorage.getItem("authToken");u.get(`${d}/note/subject/${r}`,{withCredentials:!0,headers:{Authorization:`Bearer ${e}`}}).then(t=>{t.data.success&&(c(t.data.data),p(0))}).catch(t=>{x(t),c([])})}else c([])},[r]),a.useEffect(()=>{if(n.length>0){const e=n[0];if(e&&e.filePath){const s=`${d.replace("/api","")}/uploads/${e.filePath}`;window.open(s,"_blank")}}},[n]);const A=e=>{b(e.target.files[0]),i(null),h(null)},B=()=>{if(!r){i("Please select a subject before uploading.");return}if(!g){i("Please select a file to upload.");return}m(!0),i(null),h(null);const e=localStorage.getItem("authToken"),t=new FormData;t.append("note",g),t.append("subjectId",r),u.post(`${d}/note/upload`,t,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"},withCredentials:!0}).then(s=>{s.data.success?(h("Note uploaded successfully."),b(null),u.get(`${d}/note/subject/${r}`,{withCredentials:!0,headers:{Authorization:`Bearer ${e}`}}).then(j=>{j.data.success&&(c(j.data.data),p(0))}).catch(()=>{c([])})):i("Failed to upload note.")}).catch(s=>{x(s),i("Error uploading note.")}).finally(()=>{m(!1)})};return o.jsxs("div",{style:{height:"500vh",display:"flex",flexDirection:"column",padding:"20px",boxSizing:"border-box"},children:[o.jsx("h1",{style:{textAlign:"center",marginBottom:"20px",color:"#333",fontSize:"2.5rem",fontWeight:"bold"},children:"Teacher Notes"}),o.jsx("div",{style:{marginBottom:"20px",display:"flex",flexWrap:"wrap",gap:"15px",justifyContent:"center",flexShrink:0},children:k.map(e=>o.jsx("button",{onClick:()=>$(e._id),style:{padding:"12px 30px",backgroundColor:r===e._id?"#007bff":"#f0f0f0",color:r===e._id?"#fff":"#333",border:"1px solid #007bff",borderRadius:"25px",cursor:"pointer",fontWeight:"600",boxShadow:r===e._id?"0 0 12px #007bff":"none",transition:"all 0.3s ease",minWidth:"120px",textAlign:"center"},onMouseEnter:t=>{r!==e._id&&(t.currentTarget.style.backgroundColor="#d0d0d0")},onMouseLeave:t=>{r!==e._id&&(t.currentTarget.style.backgroundColor="#f0f0f0")},children:e.subject_name},e._id))}),o.jsxs("div",{style:{marginBottom:"20px",textAlign:"center"},children:[o.jsx("input",{type:"file",accept:"application/pdf",onChange:A,disabled:f,style:{cursor:"pointer"}}),o.jsx("button",{onClick:B,disabled:f,style:{marginLeft:"10px",padding:"8px 16px",cursor:"pointer",backgroundColor:"#28a745",color:"#fff",border:"none",borderRadius:"5px",fontWeight:"600"},children:f?"Uploading...":"Upload Note"}),y&&o.jsx("p",{style:{color:"red"},children:y}),S&&o.jsx("p",{style:{color:"green"},children:S})]}),n.length>0&&o.jsxs("div",{style:{flexGrow:1,border:"1px solid #ddd",borderRadius:"10px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",backgroundColor:"#fff",display:"flex",flexDirection:"column"},children:[o.jsx("h2",{style:{marginBottom:"20px",color:"#444"},children:"Notes for selected subject:"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginBottom:"20px",flexShrink:0},children:n.map((e,t)=>o.jsxs("button",{onClick:()=>p(t),style:{padding:"8px 16px",backgroundColor:l===t?"#28a745":"#e0e0e0",color:l===t?"#fff":"#333",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",boxShadow:l===t?"0 0 8px #28a745":"none",transition:"all 0.3s ease",minWidth:"150px",textAlign:"center"},onMouseEnter:s=>{l!==t&&(s.currentTarget.style.backgroundColor="#a0dca0")},onMouseLeave:s=>{l!==t&&(s.currentTarget.style.backgroundColor="#e0e0e0")},children:["Note ",t+1]},e._id))}),o.jsx("div",{style:{flexGrow:1,overflow:"hidden"},children:o.jsx("iframe",{src:`${d.replace("/api","")}/uploads/${n[l].filePath}`,width:"100%",height:"200%",title:"Note PDF",style:{borderRadius:"10px",border:"1px solid #ccc"}})})]})]})}export{v as default};
